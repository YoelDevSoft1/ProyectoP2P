services:
  - type: web
    name: p2p-backend
    env: docker
    plan: free
    region: oregon
    rootDir: backend
    dockerfilePath: ../docker/Dockerfile.backend
    healthCheckPath: /api/v1/health
    envVars:
      - key: ENVIRONMENT
        value: production
      - key: DEBUG
        value: "false"
      - key: DATABASE_URL
        sync: false
      - key: REDIS_URL
        sync: false
      - key: RABBITMQ_URL
        sync: false
      - key: SECRET_KEY
        sync: false
      - key: BACKEND_CORS_ORIGINS
        sync: false
      - key: BINANCE_API_KEY
        sync: false
      - key: BINANCE_API_SECRET
        sync: false

  - type: worker
    name: p2p-celery-worker
    env: python
    plan: free
    region: oregon
    rootDir: backend
    buildCommand: "pip install -r requirements.txt"
    startCommand: "celery -A celery_app.worker worker --loglevel=info --concurrency=1"
    envVars:
      - key: PYTHON_VERSION
        value: 3.11.0
      - key: ENVIRONMENT
        value: production
      - key: DEBUG
        value: "false"
      - key: DATABASE_URL
        sync: false
      - key: REDIS_URL
        sync: false
      - key: RABBITMQ_URL
        sync: false
      - key: SECRET_KEY
        sync: false
      - key: BINANCE_API_KEY
        sync: false
      - key: BINANCE_API_SECRET
        sync: false

  - type: worker
    name: p2p-celery-beat
    env: python
    plan: free
    region: oregon
    rootDir: backend
    buildCommand: "pip install -r requirements.txt"
    startCommand: "celery -A celery_app.worker beat --loglevel=info"
    envVars:
      - key: PYTHON_VERSION
        value: 3.11.0
      - key: ENVIRONMENT
        value: production
      - key: DEBUG
        value: "false"
      - key: DATABASE_URL
        sync: false
      - key: REDIS_URL
        sync: false
      - key: RABBITMQ_URL
        sync: false
      - key: SECRET_KEY
        sync: false
      - key: BINANCE_API_KEY
        sync: false
      - key: BINANCE_API_SECRET
        sync: false

# Nota: Render no hospeda Redis/RabbitMQ/Postgres gestionados en este archivo; 
# usa proveedores administrados (Neon/Timescale, Upstash, CloudAMQP) y asigna
# sus URLs a las variables sincronizadas (sync: false).

